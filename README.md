# MEC
This repository provides a step-by-step guide for implementing OAI-MEC in a 5G network.

# üì° Deployment of 5G-MEC with OpenAirInterface (OAI)

This document provides a comprehensive guide for deploying a 5G MEC (Multi-access Edge Computing) infrastructure based on OpenAirInterface (OAI) components, including the Core Network, RAN, Configuration Manager (OAI-CM), MEC Platform (OAI-MEP), and the RNIS service.

---

## 1.1 Deployment of Core and RAN Components

### 1.1.1 Deployment of OAI 5G Core Network

This guide explains the deployment of the `develop` version of the OAI 5G Core Network, notably using the `oai-spgwu-UPF` component.

The **OAI-CN** (Core Network) project is available on the official GitLab: [https://gitlab.eurecom.fr/oai/cn5g/oai-cn5g-fed](https://gitlab.eurecom.fr/oai/cn5g/oai-cn5g-fed)

#### Deployment Steps:

1. **Pull Docker Images**:  
   OAI provides pre-built Docker images for each component (AMF, SMF, UPF, etc.). After extraction, each image must be referenced in the `docker-compose.yaml` file.

2. **Edit the `docker-compose.yaml` File**:  
   Configure this file to ensure stable communication between all network components.

3. **Enable IP Forwarding**:  
   By default, Docker container traffic is not routed to the outside. Enable IP forwarding using the following commands:
   ```bash
   sudo sysctl net.ipv4.conf.all.forwarding=1
   sudo iptables -P FORWARD ACCEPT
   ```

4. **Configure Subscribers (SIM)**:  
   Add OAI UE identification details in the `oai_db.sql2` file, which contains SIM parameters such as IMSI, key, operator, etc.

5. **Start the Core Network**:  
   Use the provided Python script to simplify the network startup:
   ```bash
   python3 core-network.py --type start-basic
   ```

   This script acts as a wrapper around `docker-compose` and `docker` to streamline the deployment process.

---

> **Notes**:
> - Make sure `docker`, `docker-compose`, and `python3` are installed on your machine.
> - If necessary, allow the required ports for the components (AMF, SMF, UPF, etc.) through your firewall.
> - It is recommended to use a machine with a recent Linux kernel and network namespace support for optimal compatibility.

---

## 1.1.2 Deployment of the OAI Configuration Manager (OAI-CM)

The OpenAirInterface Configuration Manager (OAI-CM) plays a critical role in the 5G-MEC architecture with OpenAirInterface. It enables the subscription to events generated by core network functions, particularly the AMF (Access and Mobility Function) and the SMF (Session Management Function), and exposes these events to other components of the MEC system.

### Key Features:
- **Subscription to AMF event notifications** via the endpoint:
  ```
  /subscribe/notification/amf
  ```
- **Subscription to SMF event notifications** via the endpoint:
  ```
  /subscribe/notification/smf
  ```

These northbound endpoints allow third-party components (such as RNIS, a MEC orchestrator, or xApps) to receive real-time events related to UE states, PDU sessions, or other relevant signaling events.

> ‚ö†Ô∏è As of today, the OAI-CM repository is in its early development stage and only supports subscriptions to events from the OAI AMF and SMF.

### References:
- Source code and detailed information are available on the OAI GitLab: [https://gitlab.eurecom.fr/oai/orchestration/blueprints](https://gitlab.eurecom.fr/oai/orchestration/blueprints) (see the `oai-cn5g-smf` or `oai-cn5g-amf` repositories, depending on recent updates).

## 1.1.3 Deployment of RAN Components

This guide outlines the process for deploying **RAN** components of OpenAirInterface (OAI), specifically the integration with **oai-mep** on **any branch of `oai-gnb`**. The source project is available here:  
üëâ [OAI RAN GitLab](https://gitlab.eurecom.fr/oai/openairinterface5g)

---

### üì¶ Cloning the OAI-RAN Project

Start by cloning the repository:

```bash
git clone https://gitlab.eurecom.fr/oai/openairinterface5g gnbs
cd gnbs
```

---

### ‚öôÔ∏è Compilation with `flexric` and USRP Support

Navigate to the build directory and execute:

```bash
cd cmake_targets/
./build_oai -I -w USRP --gNB --nrUE --build-e2 --ninja
```

#### Option Details:

- `-I`: Installs required dependencies (run once or after modifying prerequisites).
- `-w USRP`: Enables support for the **USRP** radio head via the `oai device` library.
- `--gNB`: Builds the **`nr-softmodem`** (gNB) executable.
- `--nrUE`: Builds the **`nr-uesoftmodem`** (UE) executable.
- `--build-e2`: Compiles and integrates the **E2 agent** into the gNB.
- `--ninja`: Uses **ninja** to speed up the build process.

> üîß Note: `liboai_device.so` is dynamically linked to `liboai_usrpdevif.so` (USRP) during execution.

---

### üèóÔ∏è Directory Structure and flexRIC

After compilation:

- A `flexric` folder is automatically generated:
  ```
  gnbs/openair2/E2AP/flexric
  ```

Additional instructions for compiling `flexric` supplementary programs are available in reference [31].

---

### üìù gNB Configuration

The gNB configuration file (`gnb.sa.band78.fr1.106PRB.usrpb210.conf`) must be **consistent with the SIM information** already configured in the core network database (`oai_db.sql2`).

---

### üöÄ Component Startup

#### Starting the gNB:

Follow the launch instructions provided in the main GitLab repository:  
üëâ [OAI RAN GitLab](https://gitlab.eurecom.fr/oai/openairinterface5g)

#### Launching the near-RT RIC:

```bash
cd flexric
./build/examples/ric/nearRT-RIC
```

---

### üì® RabbitMQ & Python xApp

#### Starting RabbitMQ:

```bash
docker-compose -f docker-compose/docker-compose-ran.yaml up -d rabbitmq
```

#### Running the Python xApp (RAN statistics retrieval):

```bash
python3 build/examples/xApp/python3/rnisxapp.py
```

---

### ‚úÖ Verification via RabbitMQ Interface

Access the RabbitMQ management web interface:

üîó [http://192.168.70.166:15672/#/queues](http://192.168.70.166:15672/#/queues)

**Credentials:**

- **User**: `user`
- **Password**: `password`

> The presence of a queue named `rnis_xapp` confirms that all the previous steps were successfully completed.

---

### üì¨ About RabbitMQ

RabbitMQ is a **messaging middleware** implementing the **AMQP (Advanced Message Queuing Protocol)**.  
It operates on a "queue" model, where **producers** send messages to a queue, and **consumers** retrieve them from the queue.

---

**References**:

- [30] OAI RAN GitLab: https://gitlab.eurecom.fr/oai/openairinterface5g  
- [31] flexRIC Documentation: *https://gitlab.eurecom.fr/mosaic5g/flexric*

## 1.2 Deployment of OAI-MEP

This guide describes the deployment process of the **OAI-MEP** (OpenAirInterface MEC Platform), a key component of the MEC (Multi-access Edge Computing) architecture in the OAI environment.

---

### üß± OAI-MEP Architecture

The OAI-MEP architecture is composed of the following elements:

- **OAI-MEP Gateway**: Acts as an **entry point**, redirecting **MP1 traffic** to the appropriate MEC services.
- **Kong**: Functions as a **reverse proxy** that routes traffic.
- **DaRS (Discovery and Registration Service)**: The core of the MEC platform, it exposes an **MP1 REST API** that allows:
  - `POST`: **Registering a MEC service**
  - `GET`: **Discovering all MEC services**
  - `GET` with filter: **Discovery by service type**
  - `DELETE`: **Deleting a registered service**

---

### üì¶ Cloning the Project

Clone the Git repository of the project:

```bash
git clone https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-mep.git
cd oai-mep
```

---

### üöÄ Deployment with Docker Compose

Use the following command to start all necessary services:

```bash
docker-compose -f docker-compose/docker-compose-mep.yaml up -d
```

---

### ‚ö†Ô∏è DNS or `/etc/hosts` Configuration

To ensure proper routing of MP1 traffic via Kong, it is **mandatory to configure the FQDN** `oai-mep.org` on your system.

Add the following line to your `/etc/hosts` file:

```bash
192.168.70.2 oai-mep.org
```

> ‚ùó If this configuration is not set, **OAI-MEP will not be able to correctly route MP1 traffic** to the hosted MEC services.

---

### üåê MP1 API ‚Äì Features

The **MP1** interface exposed by **DaRS** enables interaction with MEC services:

| Method  | Function                                      | Usage Example                  |
|---------|-----------------------------------------------|--------------------------------|
| POST    | Register a MEC service                        | `curl -X POST <url>`           |
| GET     | Discover all services                         | `curl -X GET <url>`            |
| GET     | Filtered discovery by service type            | `curl -X GET <url>?type=xyz`   |
| DELETE  | Delete a registered service                   | `curl -X DELETE <url>/<id>`    |

> These calls can be tested using `curl`, Postman, or any other REST interface.

---

### üìö Reference

- [27] OAI-MEP GitLab: [https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-mep](https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-mep)

---

‚úÖ Once the service is running and the domain name is properly configured, the OAI-MEP platform is ready to host and orchestrate your MEC services via the MP1 interface.

## 1.3 Deployment of OAI-RNIS

OAI-RNIS (Radio Network Information Service) is a key component of the MEC architecture, designed to provide **user-specific radio data**, based on **ETSI MEC GS 012** specifications adapted for a **5G Standalone (SA)** implementation.

---

### üß± Functional Architecture

OAI-RNIS is composed of several modules, referred to as **rnisApp** or **rnisService**, with the following main roles:

- **Northbound API**: RESTful interface exposing RNIS data.
- **Data Convergence Service**: Aggregates data from mp2 sources (3GPP network).
- **Notification Service**: Sends RNIS events to subscribed services via HTTP.
- **Core Network Wrapper Service**: Consumes 5G core events via **OAI-CM**.
- **KPIs-xApp Service**: Retrieves radio metrics from the E2 agent of the RAN xApp.

---

### üì¶ Cloning the Project

The OAI-RNIS project can be cloned using the following command:

```bash
git clone https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-rnis.git
cd oai-rnis
```

---

### üöÄ Operation and Integration

- RNIS extracts data from the 3GPP network via the **mp2 interface**.
- These data are then exposed through the **mp1 interface**.
- On startup, **OAI-RNIS automatically registers** its service with **OAI-MEP** via a `POST` mp1 call.

---

### üì° Key Modules

| Module                    | Function                                                                 |
|--------------------------|--------------------------------------------------------------------------|
| Core Network Wrapper      | Retrieves 5G events exposed by OAI-CM                                   |
| KPIs-xApp Service         | Collects RAN statistics via xApp (e.g., `rnis-xApp`)                    |
| Data Convergence Service  | Aggregates collected data and triggers RNIS events                      |
| Notification Service      | Sends data to subscribers via HTTP                                      |
| Northbound API            | Exposes RNIS data via REST using mp1                                    |

> ‚öôÔ∏è The architecture is **scalable** depending on the number of MEC nodes or applications to be integrated.

---

### üìä Retrieving KPIs

Two methods allow a MEC application to access KPIs via MP1:

#### ‚úÖ Method 1: Direct GET request

Use the following command:

```bash
curl -X 'GET' 'http://oai-mep.org/rnis/v2/queries/layer2_meas' -H 'accept: application/json'
```

#### üì• Method 2: Subscription with automatic KPI delivery

A sample **MEC application** written in **Python Flask** is provided to automatically consume KPIs:

```bash
python3 examples/example-mec-app.py
```

> ‚ö†Ô∏è You **must start a UE (User Equipment)** to obtain valid KPI data.

KPIs can then be:
- Viewed through the **MEC app‚Äôs web dashboard**.
- Or manually retrieved using GET:

```bash
curl -X 'GET' 'http://oai-mep.org/rnis/v2/queries/layer2_meas' -H 'accept: application/json'
```

---

### üåê RNIS Interfaces

| Interface | Description                                                     |
|-----------|-----------------------------------------------------------------|
| mp1       | RESTful interface for MEC consumers                             |
| mp2       | Integration interface towards the 3GPP network (via OAI-CM/RAN) |

---

### üìö Reference

- [32] GitLab OAI-RNIS: https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-rnis

---

‚úÖ Once launched, OAI-RNIS becomes a critical MEC component for delivering **precise radio indicators** to dynamic, intelligent edge applications.
